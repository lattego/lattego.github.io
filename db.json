{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/tags/index.md","hash":"143e969351ea9110c69c6836c822acbcee5c14ed","modified":1661501509176},{"_id":"source/_posts/RocketMQ-Cluster.md","hash":"3b3daea5a08fb9bb1e09a0a6350f01d0cad711fc","modified":1661501790539},{"_id":"node_modules/hexo-theme-butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":1661409000449},{"_id":"node_modules/hexo-theme-butterfly/README.md","hash":"249abda2d59e738d8e5416c9b0e2727fc73493dd","modified":1661409001624},{"_id":"node_modules/hexo-theme-butterfly/README_CN.md","hash":"ec3df032fa5e197eef3822c1af517e29a91da2df","modified":1661409001615},{"_id":"node_modules/hexo-theme-butterfly/_config.yml","hash":"76f9883745d6d28f751f76328aa04b20865d09fb","modified":1661409002475},{"_id":"node_modules/hexo-theme-butterfly/package.json","hash":"857c4d128fab303bfa33efac5c414776bead6820","modified":1661409001608},{"_id":"node_modules/hexo-theme-butterfly/plugins.yml","hash":"b96cbef0a8af718b1b7bbe3317bb7a15484e7985","modified":1661409002501},{"_id":"node_modules/hexo-theme-butterfly/languages/default.yml","hash":"1e37a3695d50e3e61d7c36e58a6dac872a4a56cd","modified":1661409002491},{"_id":"node_modules/hexo-theme-butterfly/languages/en.yml","hash":"d1bb560698eb8b0079495b7b18b44facb610f9fd","modified":1661409002494},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-CN.yml","hash":"28b6f0c39155651d747eb595e0a283bc97be2e09","modified":1661409002515},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-TW.yml","hash":"947f794e862bb2813e36887f777bdb760f70a322","modified":1661409002520},{"_id":"node_modules/hexo-theme-butterfly/layout/archive.pug","hash":"a0c034c2d319320a54046805e80b58dc48b7e233","modified":1661409001707},{"_id":"node_modules/hexo-theme-butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":1661409001800},{"_id":"node_modules/hexo-theme-butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":1661409001943},{"_id":"node_modules/hexo-theme-butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":1661409002051},{"_id":"node_modules/hexo-theme-butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":1661409002093},{"_id":"node_modules/hexo-theme-butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":1661409002204},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"67e4f5a66d4b8cabadbaad0410628364ee75e0ae","modified":1661409002481},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7dfe7189ffeaebb6db13842237f8e124649bea3d","modified":1661409002485},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":1661409002497},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":1661409002509},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":1661409002512},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":1661409001642},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/additional-js.pug","hash":"594a977ebe8d97e60fa3d7cb40fc260ded4d8a58","modified":1661409001661},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":1661409001865},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head.pug","hash":"de8e618ec03295561c667a49e1c383213b856f6f","modified":1661409001892},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/layout.pug","hash":"a557280a25f63f4312afad63fc3303ec74165557","modified":1661409001959},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/pagination.pug","hash":"0b80f04950bd0fe5e6c4e7b7559adf4d0ce28436","modified":1661409002056},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/rightside.pug","hash":"699d0d2cff233628752956c4434125c8203f7d63","modified":1661409002172},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/sidebar.pug","hash":"8d39473ed112d113674a0f689f63fae06c72abd2","modified":1661409002185},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":1661409001048},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/cdn.js","hash":"acfe765fb2c607bff7198630dbfa53a888c36357","modified":1661409001295},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/comment.js","hash":"a3d1f417965ca20253c36f9e93429f3df6268856","modified":1661409001314},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/init.js","hash":"b4940a5c73d3a5cd8bb5883e3041ecdd905a74e0","modified":1661409001400},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":1661409001554},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/welcome.js","hash":"3cfc46c749e2fd7ae9c2a17206238ed0e0e17e7d","modified":1661409001602},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":1661409001527},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/random_cover.js","hash":"21379ed2dccb69c43b893895c9d56238c11e5f43","modified":1661409001540},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":1661409001202},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":1661409001233},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/findArchiveLength.js","hash":"ee3e70098eb0849497d50b75e18cf4a27c397d52","modified":1661409001332},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/inject_head_js.js","hash":"b4cd617c619d1a0df93603721a6fa1317526174b","modified":1661409001416},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/page.js","hash":"763dab5c83f50c1c62fffc9a9dfedea29bb4e629","modified":1661409001511},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/related_post.js","hash":"d368a8830e506c8b5eb6512b709ec8db354d5ea1","modified":1661409001545},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":1661409001277},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":1661409001349},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/gallery.js","hash":"f79c99f6c5b626c272dc2bed2b0250d6b91bb28a","modified":1661409001366},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":1661409001386},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":1661409001427},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":1661409001440},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":1661409001487},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/note.js","hash":"d51812b43924f1bbf413c67499510dd125022005","modified":1661409001500},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":1661409001566},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":1661409001575},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","hash":"861998e4ac67a59529a8245a9130d68f826c9c12","modified":1661409002405},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","hash":"4890a40366d6443f8b8942a4e9a6dce9fe3494f5","modified":1661409002468},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1661409000950},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1661409001630},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1661409000862},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","hash":"73d2624ed465e4cfb1ebb00b2c8a24f5fc29bb21","modified":1661409001475},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1661409001585},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1661409001593},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/Open_Graph.pug","hash":"6c41f49a3e682067533dd9384e6e4511fc3a1349","modified":1661409002047},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/analytics.pug","hash":"15530d9ac59c576d79af75dd687efe71e8d261b0","modified":1661409001688},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config.pug","hash":"8f41fa9732ea654a10f6e666d9c782c7e27e5ea6","modified":1661409001816},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":1661409001810},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":1661409001889},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":1661409002043},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/preconnect.pug","hash":"65a23b5170204e55b813ce13a79d799b66b7382c","modified":1661409002104},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":1661409002114},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/index.pug","hash":"aa175e2254704335f4da09175e59ef2375ca7d03","modified":1661409001897},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":1661409002190},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":1661409002008},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/nav.pug","hash":"78a3abd90bb3c18cd773d3d5abac3541e7f415e5","modified":1661409002034},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/post-info.pug","hash":"9698f22751778dde063cbfbd01c59ca4462ccd85","modified":1661409002081},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":1661409002193},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/loading-js.pug","hash":"4cfcf0100e37ce91864703cd44f1cb99cb5493ea","modified":1661409001974},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/loading.pug","hash":"5276937fbcceb9d62879dc47be880cd469a27349","modified":1661409001979},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/post-ui.pug","hash":"6ae047d566289294cc2f6192cacbff297cec9f1a","modified":1661409002088},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":1661409001796},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/article-sort.pug","hash":"2fb74d0b0e4b98749427c5a1a1b0acb6c85fadc4","modified":1661409001729},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":1661409001829},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/tags.pug","hash":"6311eda08e4515281c51bd49f43902a51832383c","modified":1661409002208},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/flink.pug","hash":"fed069baa9b383f57db32bb631115071d29bdc60","modified":1661409001862},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":1661409002073},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":1661409002166},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":1661409001697},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":1661409001849},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":1661409002059},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pjax.pug","hash":"6d6474ef186c18d9b4f334e1f735eadd6699effa","modified":1661409002063},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":1661409002109},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/subtitle.pug","hash":"142621f70bedcb5033ee99a988f7bb6c5eea3493","modified":1661409002199},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":1661409001737},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":1661409001740},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":1661409001744},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":1661409001752},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_author.pug","hash":"e37468e63db2a0ac09b65d21b7de3e62425bb455","modified":1661409001748},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":1661409001756},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":1661409001769},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_newest_comment.pug","hash":"6d93564a8bd13cb9b52ee5e178db3bcbf18b1bc6","modified":1661409001765},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_recent_post.pug","hash":"9c1229af6ab48961021886882c473514101fba21","modified":1661409001773},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_tags.pug","hash":"438aea3e713ed16b7559b9a80a9c5ec0221263df","modified":1661409001779},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":1661409001785},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":1661409001789},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/index.pug","hash":"7fb096656c8a6c21a4b6a5100885b1081d6021ed","modified":1661409001940},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/function.styl","hash":"644d520fe80cc82058467708ab82ccad313b0c27","modified":1661409002367},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/index.styl","hash":"714f19e7d66df84938bd1b82b33d5667abe1f147","modified":1661409002392},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight.styl","hash":"2f95e99b8351fbecd9037a1bbdc3fee9d6ea8a77","modified":1661409002387},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":1661409002457},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/darkmode.styl","hash":"a92984f566c97bb4179f34be79240af1552c6f17","modified":1661409002337},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/readmode.styl","hash":"69f8e9414526dfda3af9a71c8e528fdd0ecbbfe5","modified":1661409002430},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/aside.styl","hash":"a0010d833ed30211601c1e0bbbc68e85b77428c6","modified":1661409002294},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":1661409002318},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":1661409002327},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/footer.styl","hash":"26be2afa9d4e7016cf3c42a6cd166f01e8e4ad5c","modified":1661409002361},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/head.styl","hash":"a457a0dbe23af21a7b6b8bfc5ee103c9fe92e89c","modified":1661409002376},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":1661409002423},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/loading.styl","hash":"ef21990de28bd75dcd0f88b8d616e1a7a137502f","modified":1661409002416},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/post.styl","hash":"15056fba0bd5a45ea8dc97eb557f6929ff16797a","modified":1661409002425},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":1661409002433},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":1661409002435},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/rightside.styl","hash":"bd88ee30ebf8ca2e7b4d3a034c317fd61733921f","modified":1661409002437},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":1661409002441},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/third-party.styl","hash":"8314e9749eb1ae40c4bae9735b7a6638b2d6876a","modified":1661409002461},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":1661409002271},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/archives.styl","hash":"6f4b4ede52305bce9b22c8c897dcbde8af6e2ce4","modified":1661409002284},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":1661409002313},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/common.styl","hash":"a58d35d698885f1034dedbe99f7dbc1a801412c6","modified":1661409002330},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":1661409002357},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/homepage.styl","hash":"8c90483d461e09cb06e91b16d8bb7b3205b0a40c","modified":1661409002390},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":1661409002447},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/algolia.styl","hash":"51e45625929d57c9df3ba9090af99b9b7bb9a15b","modified":1661409002280},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/index.styl","hash":"39d61cbe0c1e937f83ba3b147afaa29b4de2f87d","modified":1661409002400},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/local-search.styl","hash":"25e58a7a8bda4b73d0a0e551643ca01b09ccd7e5","modified":1661409002418},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":1661409002306},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/gallery.styl","hash":"a310e48f826a4cacc55d8e68f43806e5085554f6","modified":1661409002370},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":1661409002378},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":1661409002380},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":1661409002408},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":1661409002410},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":1661409002445},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":1661409002464},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/note.styl","hash":"85ae91c83691ea4511f4277da1194a185251cc78","modified":1661409002420},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":1661409001451},{"_id":"node_modules/hexo-theme-butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":1661409000606},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","hash":"9feb248552667c53ce1b19bc7a295215f8c77008","modified":1661409001151},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"99d9b17668260b242749c16851d9ec1024d31899","modified":1661409001712},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":1661409001836},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"f0ddc0f1ffee143d86c81bee1136ae6ee01e8ea5","modified":1661409001859},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":1661409001901},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":1661409002126},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"58406a7a3bf45815769f652bf3ef81e57dcd07eb","modified":1661409002221},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":1661409002237},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"5f648086a33a32d169a2f8d8c549c08aa02f67db","modified":1661409002248},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":1661409001820},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":1661409001824},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":1661409001883},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/index.pug","hash":"0611d9216f4c128ebdea4cc21454c3dc4a6398d5","modified":1661409001905},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/messenger.pug","hash":"bfe7b5a8fad041b63a10c6c6ed02e7c87afb94cd","modified":1661409002027},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":1661409002213},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/artalk.pug","hash":"49dcc23815e1d5264bb65c91e7dc67b1a723d1ea","modified":1661409001718},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqus.pug","hash":"8ec24c1939895ac0db2b2e8700bc9307b4ceb53c","modified":1661409001842},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"2c095186033b6b273634ce97a75873da1f3646db","modified":1661409001854},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"98ef20f8a3b10c1692f9b2b3c06033d2da8a8eae","modified":1661409001845},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/giscus.pug","hash":"591ef23c583690bd74af0cafb09af64ba5bd8151","modified":1661409001869},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"22e2ef30fe5eb1db7566e89943c74ece029b2a8e","modified":1661409001874},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/index.pug","hash":"351fe25fbf02635b1f9e86e5e244c7d61f69baa7","modified":1661409001908},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":1661409001948},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":1661409001966},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/remark42.pug","hash":"e9bdf80d6796afc04eb809dbbe780d97f22c7fcd","modified":1661409002153},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"e18fbd88d8942e53e771f29b26209ab735c5c567","modified":1661409002227},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/utterances.pug","hash":"a737046e730eb7264606ba0536218964044492f9","modified":1661409002233},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":1661409001805},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":1661409002241},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/waline.pug","hash":"15462d1ed04651ad3b430c682842ac400f6f9b47","modified":1661409002253},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":1661409001913},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":1661409001953},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mathjax.pug","hash":"f4dc7d02c8192979404ae9e134c5048d3d0a76e2","modified":1661409001990},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mermaid.pug","hash":"8e33aca36a4d3ae9e041ba05ced8eff56ae38f77","modified":1661409002018},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"c12c898b35dd014780c1f3220ddbe12e7270983c","modified":1661409001724},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"04b2a5882e789a988e41d45abe606f0617b08e38","modified":1661409001833},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"e846ddfe4a63b15d1416f6055f5756af5e3da7c6","modified":1661409001879},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":1661409001920},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"ab167c00da4506f591b96f0591bf5bd214a26d4b","modified":1661409002161},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"233907dd7f5b5f33412701d2ccffbc0bbae8707b","modified":1661409002217},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d19e1c2c0a50f0e4547d71a17b9be88e8152f17c","modified":1661409002246},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"dd0bc119029b62dce5dc965d5de7377e438fa29a","modified":1661409002261},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/algolia.pug","hash":"e8245d0b4933129bb1c485d8de11a9e52e676348","modified":1661409001679},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":1661409001925},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/local-search.pug","hash":"178c9cdcc4ce5a006885b24ce4a3d624e4734899","modified":1661409001984},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":1661409001652},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":1661409001934},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/share-js.pug","hash":"f61d63724ea5c5f352568b3a16bde023affefbe5","modified":1661409002178},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":1661409001666},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":1661409002395},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":1661409002352},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":1661409002344},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":1661409002398},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":1661409002413},{"_id":"public/tags/index.html","hash":"049c34e93bc7aaac9b05cbc24c09bcc25698b1df","modified":1661501894533},{"_id":"public/archives/index.html","hash":"4b3a51ed9a38bc98e27ad6c0dcaaf80f256bd759","modified":1661501894533},{"_id":"public/archives/2022/index.html","hash":"5e7508cbbe2fb7d3584c4f3dca5ef82b22c8a485","modified":1661501894533},{"_id":"public/archives/2022/08/index.html","hash":"b0a8b30f0754251a01a4d9e4c2833c718d31abb8","modified":1661501894533},{"_id":"public/index.html","hash":"bc0e8c7215901fd1fcf5d5a23acaa37958c5b7f1","modified":1661501894533},{"_id":"public/tags/开发环境/index.html","hash":"c7508312cb6cbdd836ef58a63b49f1ff2be1b4a5","modified":1661500341231},{"_id":"public/2022/08/25/RocketMQ-Cluster/index.html","hash":"c83be0f2add38cb18e0f7c8c733ac087fe39f51d","modified":1661501894533},{"_id":"public/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":1661420761282},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1661420761282},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1661420761282},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1661420761282},{"_id":"public/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1661420761282},{"_id":"public/js/search/algolia.js","hash":"9feb248552667c53ce1b19bc7a295215f8c77008","modified":1661420761282},{"_id":"public/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":1661420761282},{"_id":"public/css/index.css","hash":"892e3c40d2d7c877e8e614bf4b508efb3cfa1796","modified":1661420761282},{"_id":"public/js/main.js","hash":"73d2624ed465e4cfb1ebb00b2c8a24f5fc29bb21","modified":1661420761282},{"_id":"public/js/tw_cn.js","hash":"00053ce73210274b3679f42607edef1206eebc68","modified":1661420761282},{"_id":"source/categories/index-1.md","hash":"d4c1ca091cee144a12a8d5ef2db6b2305636bfb6","modified":1661500882606},{"_id":"source/categories/index.md","hash":"aa23afbe14cdf6d37d2c90f019ba1b1164f76438","modified":1661501509170},{"_id":"public/categories/index.html","hash":"cdd534cf97e7f69ed2331014bd5fcdcf195cb73b","modified":1661501894533},{"_id":"public/categories/Development-Environment/index.html","hash":"58816e38c6fb207dbabcd07fa5eedd2d36466865","modified":1661501894533},{"_id":"public/tags/Linux/index.html","hash":"91187debbc4c10cfba3f1476217183e2026831f0","modified":1661501894533},{"_id":"public/tags/RocketMQ/index.html","hash":"7296dfa93d6a8466fe6cc39f2e9b95a2ac886f4e","modified":1661501894533}],"Category":[{"name":"Development Environment","_id":"cl7a6yja90000zw7eg86sawgf"}],"Data":[],"Page":[{"title":"标签","date":"2022-08-25T06:50:53.000Z","top_img":"https://api.lattice.vip/manage/file/图片/category-20220826040937428.jpg","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2022-08-25 14:50:53\ntop_img: https://api.lattice.vip/manage/file/图片/category-20220826040937428.jpg\ntype: \"tags\"\n---\n","updated":"2022-08-26T08:11:49.176Z","path":"tags/index.html","_id":"cl78v0x5c00006c7e1nme7o3k","comments":1,"layout":"page","content":"","site":{"data":{}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""},{"title":"分类","date":"2022-08-26T07:59:08.000Z","top_img":"https://api.lattice.vip/manage/file/图片/category-20220826040937428.jpg","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2022-08-26 15:59:08\ntop_img: https://api.lattice.vip/manage/file/图片/category-20220826040937428.jpg\ntype: \"categories\"\n---\n","updated":"2022-08-26T08:11:49.170Z","path":"categories/index.html","_id":"cl7a6qc3b0001947e70ad73c8","comments":1,"layout":"page","content":"","site":{"data":{}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""}],"Post":[{"title":"向往的开发环境搭建（一）：RocketMQ Cluster","date":"2022-08-25T08:40:47.000Z","cover":"https://api.lattice.vip/manage/file/图片/category-20220826040937428.jpg","_content":"## 向往的开发环境搭建（一）：RocketMQ Cluster\n\n> 本文基于Docker虚拟化容器技术，实现一台虚拟机作为宿主机，安装Docker环境部署RocketMQ（2M-2S-Namesrv）集群环境\n\n### 前言\n\n- 前文回顾\n    - [I5-12600KF | 升级老式台式机](https://v2ex.com/t/870873)\n    - [装机后续：i7-12700 + 华硕 B660M 重炮手装机实操](https://v2ex.com/t/871352)\n- 继台式机组装完成后，便开始在脑子中有一个想法：搭建一个程序员必备 /向往的开发环境，最终的蓝图是希望能最大化利用台式机的性能，开机后即可拥有一套现成的本地“云”开发集群环境\n- 第一篇便从最近学习的 RocketMQ 出发，基于 Docker 虚拟化容器技术，实现一台虚拟机作为宿主机，安装 Docker 环境部署 RocketMQ （ 2M-2S-Namesrv ）集群环境\n- 后续可能会考虑搭建 MySQL 主从、Redis 等中间件集群环境，用以分享学习交流~\n\n### 虚拟机环境\n\n- 官网下载 Centos7 ISO 镜像文件 【CentOS-7-x86_64-Minimal-2207-02】 [清华大学CentOS-7镜像站](https://mirrors.tuna.tsinghua.edu.cn/centos/7.9.2009/isos/x86_64/)\n\n- 启动VamwarePro安装Centos7\n\n- 配置虚拟机参数\n\n    - 4核/16G/80G-SSD\n    - IP: 192.168.2.246\n\n- 静态IP配置，vim /etc/sysconfig/network-scripts/ifcfg-ens33\n\n    - BOOTPROTO=\"static\"\n\n    - IPADDR=192.168.2.246\n\n    - NETMASK=255.255.255.0\n\n    - GATEWAY=192.168.2.1\n\n    - DNS1=119.29.29.29\n\n    - ```properties\n    TYPE=\"Ethernet\"\n    PROXY_METHOD=\"none\"\n    BROWSER_ONLY=\"no\"\n    BOOTPROTO=\"static\"\n    DEFROUTE=\"yes\"\n    IPV4_FAILURE_FATAL=\"no\"\n    IPV6INIT=\"yes\"\n    IPV6_AUTOCONF=\"yes\"\n    IPV6_DEFROUTE=\"yes\"\n    IPV6_FAILURE_FATAL=\"no\"\n    IPV6_ADDR_GEN_MODE=\"stable-privacy\"\n    NAME=\"ens33\"\n    UUID=\"deb20895-5574-4f53-89da-d5ccb3a68bf2\"\n    DEVICE=\"ens33\"\n    ONBOOT=\"yes\"\n    IPV6_PRIVACY=\"no\"\n    IPADDR=192.168.2.246\n    NETMASK=255.255.255.0\n    GATEWAY=192.168.2.1\n    DNS1=119.29.29.29\n    ```\n\n\n### 安装Docker、Docker-Compose\n\n```bash\n# 安装docker\n[root@localhost ~]# yum install -y yum-utils device-mapper-persistent-data lvm2\n[root@localhost ~]# yum -y install docker-ce\n[root@localhost ~]# systemctl start docker\n[root@localhost ~]# systemctl enable docker\n# 安装docker-compose\n[root@localhost ~]# yum install docker-compose \n# 查看docker-compose版本信息\n[root@localhost ~]# docker-compose -v\n```\n\n### 双主双从(2M-2S-ASYNC)\n\n> 异步复制性能最佳，但是存在节点故障时，Master无法正常写入Slave导致部分消息丢失\n\n- 部署方式：`Docker`，共享宿主机配置\n\n- 集群配置：`2M-2S-ASYNC`、`2Namesrv`\n\n#### 宿主机创建配置文件，日志目录，用来映射容器中的路径\n\n```bash\n# 创建日志目录文件夹\n[root@localhost conf]# mkdir -p /data/docker/rocketmq/{logs-namesrv-m,logs-namesrv-s,logs-broker-a,store-a,conf,logs-broker-b,store-b,logs-broker-a-s,store-a-s,logs-broker-b-s,store-b-s}\n# 编写主从配置文件\n[root@localhost conf]# vim broker-a.conf\n[root@localhost conf]# vim broker-a-s.conf\n[root@localhost conf]# vim broker-b.conf\n[root@localhost conf]# vim broker-b-s.conf\n```\n\n**broker-a.conf**\n\n```properties\n#所属集群名字，同一个集群名字相同\nbrokerClusterName=rocketmq-cluster\n#broker名字\nbrokerName=broker-a\n#0表示master >0 表示slave\nbrokerId=0\n#删除文件的时间点，凌晨4点\ndeleteWhen=04\n#文件保留时间 默认是48小时\nfileReservedTime=168\n#异步复制Master\nbrokerRole=ASYNC_MASTER\n#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 \nflushDiskType=ASYNC_FLUSH\n#Broker 对外服务的监听端口\nlistenPort=10911\n#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）\nnamesrvAddr=192.168.2.246:9876\n#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡\ndefaultTopicQueueNums=8\n#是否允许 Broker 自动创建Topic，生产建议关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，生产建议关闭\nautoCreateSubscriptionGroup=true\n#设置BrokerIP\nbrokerIP1=192.168.2.246\n```\n\n**broker-a-s.conf**\n\n```properties\n#所属集群名字\nbrokerClusterName=rocketmq-cluster\n#broker名字，注意此处不同的配置文件填写的不一样  例如：在a.properties 文件中写 broker-a  在b.properties 文件中写 broker-b\nbrokerName=broker-a\n#0 表示 Master，>0 表示 Slave\nbrokerId=1\n#删除文件时间点，默认凌晨 4点\ndeleteWhen=04\n#文件保留时间，默认 48 小时\nfileReservedTime=168\n#Broker 的角色，ASYNC_MASTER=异步复制Master，SYNC_MASTER=同步双写Master，SLAVE=slave节点\nbrokerRole=SLAVE\n#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 \nflushDiskType=SYNC_FLUSH\n#Broker 对外服务的监听端口\nlistenPort=12911\n#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）\nnamesrvAddr=192.168.2.246:9876\n#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡\ndefaultTopicQueueNums=8\n#是否允许 Broker 自动创建Topic，生产建议关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，生产建议关闭\nautoCreateSubscriptionGroup=true\n#设置BrokerIP\nbrokerIP1=192.168.2.246\n\n```\n\n**broker-b.conf**\n\n```properties\n#所属集群名字\nbrokerClusterName=rocketmq-cluster\n#broker名字，注意此处不同的配置文件填写的不一样  例如：在a.properties 文件中写 broker-a  在b.properties 文件中写 broker-b\nbrokerName=broker-b\n#0 表示 Master，>0 表示 Slave\nbrokerId=0\n#删除文件时间点，默认凌晨 4点\ndeleteWhen=04\n#文件保留时间，默认 48 小时\nfileReservedTime=168\n#Broker 的角色，ASYNC_MASTER=异步复制Master，SYNC_MASTER=同步双写Master，SLAVE=slave节点\nbrokerRole=ASYNC_MASTER\n#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 \nflushDiskType=SYNC_FLUSH\n#Broker 对外服务的监听端口\nlistenPort=11911\n#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）\nnamesrvAddr=192.168.2.246:9876\n#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡\ndefaultTopicQueueNums=8\n#是否允许 Broker 自动创建Topic，生产建议关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，生产建议关闭\nautoCreateSubscriptionGroup=true\n#设置BrokerIP\nbrokerIP1=192.168.2.246\n```\n\n**broker-b-s.conf**\n\n```properties\n#所属集群名字\nbrokerClusterName=rocketmq-cluster\nbrokerName=broker-b\n#slave\nbrokerId=1\ndeleteWhen=04\nfileReservedTime=168\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\n#Broker 对外服务的监听端口\nlistenPort=13911\n#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）\nnamesrvAddr=192.168.2.246:9876\n#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡\ndefaultTopicQueueNums=8\n#是否允许 Broker 自动创建Topic，生产建议关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，生产建议关闭\nautoCreateSubscriptionGroup=true\n#设置BrokerIP\nbrokerIP1=192.168.2.246\n```\n\n#### 构建docker-compose.yml配置文件\n\n```yaml\nversion: '2'\nservices:\n  namesrv1:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: namesrv1\n    ports:\n      - 9876:9876\n    volumes:\n      - /data/docker/rocketmq/logs-namesrv-m:/home/rocketmq/logs\n    environment:\n      JAVA_OPT_EXT: -server -Xms256M -Xmx256M -Xmn128m\n    command: sh mqnamesrv\n  broker-a-m:\n      image: foxiswho/rocketmq:4.8.0\n      container_name: broker-a-master\n      ports:\n        - 10909:10909\n        - 10911:10911\n        - 10912:10912\n      volumes:\n      - /data/docker/rocketmq/logs-broker-a:/home/rocketmq/logs\n      - /data/docker/rocketmq/store-a:/home/rocketmq/store\n      - /data/docker/rocketmq/conf/broker-a.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n      environment:\n        JAVA_OPT_EXT: -server -Xms256m -Xmx256m -Xmn128m\n        NAMESRV_ADDR: 192.168.2.246:9876\n      command: sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n  broker-b-m:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: broker-b-master\n    ports:\n      - 11909:11909\n      - 11911:11911\n      - 11912:11912\n    volumes:\n    - /data/docker/rocketmq/logs-broker-b:/home/rocketmq/logs\n    - /data/docker/rocketmq/store-b:/home/rocketmq/store\n    - /data/docker/rocketmq/conf/broker-b.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n    environment:\n      JAVA_OPT_EXT: -server -Xms256m -Xmx256m -Xmn128m\n      NAMESRV_ADDR: 192.168.2.246:9876\n    command: sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n  broker-a-s:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: broker-a-slave\n    ports:\n      - 12909:12909\n      - 12911:12911\n      - 12912:12912\n    volumes:\n      - /data/docker/rocketmq/logs-broker-a-s:/home/rocketmq/logs\n      - /data/docker/rocketmq/store-a-s:/home/rocketmq/store\n      - /data/docker/rocketmq/conf/broker-a-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n    environment:\n      JAVA_OPT_EXT: -server -Xms256m -Xmx256m -Xmn128m\n      NAMESRV_ADDR: 192.168.2.246:9876\n    command: sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n  broker-b-s:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: broker-b-slave\n    ports:\n      - 13909:13909\n      - 13911:13911\n      - 13912:13912\n    volumes:\n      - /data/docker/rocketmq/logs-broker-b-s:/home/rocketmq/logs\n      - /data/docker/rocketmq/store-b-s:/home/rocketmq/store\n      - /data/docker/rocketmq/conf/broker-b-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n    environment:\n      JAVA_OPT_EXT: -server -Xms256m -Xmx256m -Xmn128m\n      NAMESRV_ADDR: 192.168.2.246:9876\n    command: sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n    depends_on:\n      - namesrv1\n```\n\n#### 主从节点配置信息\n\n| System Info  | IP:PORT               | BrokerId |\n| ------------ | --------------------- | -------- |\n| `namesrv1`   | 192.168.2.246:`9876`  |          |\n| `broker-a`   | 192.168.2.246:`10911` | 0        |\n| `broker-a-s` | 192.168.2.246:`12911` | 1        |\n| `broker-b`   | 192.168.2.246:`11911` | 0        |\n| `broker-b-s` | 192.168.2.246:`13911` | 1        |\n\n#### Docker容器分布\n\n![image-20220820204340646](https://img.lattice.vip/typora/2022/image-20220820204340646.png)\n\n### 部署RocketMQ-Console\n\n获取RocketMQ-Console镜像，连接NameServer中心，新版本以及迁移到新的Repo,名称为RockeMQ-Dashboard\n\n```bash\n# 拉取控制台镜像\nlattice@lattice-cluster-01:/$docker pull styletang/rocketmq-console-ng\n# 启动容器\nlattice@lattice-cluster-01:/$docker run -d -e \"JAVA_OPTS=-Drocketmq.config.namesrvAddr=192.168.2.246:9876 -Drocketmq.config.isVIPChannel=false\" -p 8088:8080 -t styletang/rocketmq-console-ng    \n```\n\n部署成功界面\n\n![image-20220819082950746](https://img.lattice.vip/typora/2022/image-20220819082950746.png)\n\n### 遇到的问题\n\n- broker exited 253\n\n    - 最终定位下来问题原因，映射到宿主机的目录卷权限不够，无法应用broker等的配置文件，以及无法操作日志目录\n\n- 宿主机普通用户每次操作docker命令都需要指定sudo，甚是麻烦\n\n    - 解决方案：加入docker组\n\n    - ```bash\n    sudo usermod -aG docker xxx\n    ```\n\n- 一直报file path的问题，需要手动创建对应目录\n\n    - ```\n    mkdir /data/docker/rocketmq/store-a/commitlog/\n    mkdir /data/docker/rocketmq/store-a/consumequeue/\n    ```\n\n- 搭建集群的过程中确实有遇到一些莫名其妙的问题，例如 Namesrv 最开始部署了两台，9876/9877 ，最终却连不上 9877 ，后来便放弃，使用单节点 Namesrv","source":"_posts/RocketMQ-Cluster.md","raw":"---\ntitle: 向往的开发环境搭建（一）：RocketMQ Cluster\ndate: 2022-08-25 16:40:47\ncover: https://api.lattice.vip/manage/file/图片/category-20220826040937428.jpg\ntags: [Linux, RocketMQ]\ncategories: Development Environment\n---\n## 向往的开发环境搭建（一）：RocketMQ Cluster\n\n> 本文基于Docker虚拟化容器技术，实现一台虚拟机作为宿主机，安装Docker环境部署RocketMQ（2M-2S-Namesrv）集群环境\n\n### 前言\n\n- 前文回顾\n    - [I5-12600KF | 升级老式台式机](https://v2ex.com/t/870873)\n    - [装机后续：i7-12700 + 华硕 B660M 重炮手装机实操](https://v2ex.com/t/871352)\n- 继台式机组装完成后，便开始在脑子中有一个想法：搭建一个程序员必备 /向往的开发环境，最终的蓝图是希望能最大化利用台式机的性能，开机后即可拥有一套现成的本地“云”开发集群环境\n- 第一篇便从最近学习的 RocketMQ 出发，基于 Docker 虚拟化容器技术，实现一台虚拟机作为宿主机，安装 Docker 环境部署 RocketMQ （ 2M-2S-Namesrv ）集群环境\n- 后续可能会考虑搭建 MySQL 主从、Redis 等中间件集群环境，用以分享学习交流~\n\n### 虚拟机环境\n\n- 官网下载 Centos7 ISO 镜像文件 【CentOS-7-x86_64-Minimal-2207-02】 [清华大学CentOS-7镜像站](https://mirrors.tuna.tsinghua.edu.cn/centos/7.9.2009/isos/x86_64/)\n\n- 启动VamwarePro安装Centos7\n\n- 配置虚拟机参数\n\n    - 4核/16G/80G-SSD\n    - IP: 192.168.2.246\n\n- 静态IP配置，vim /etc/sysconfig/network-scripts/ifcfg-ens33\n\n    - BOOTPROTO=\"static\"\n\n    - IPADDR=192.168.2.246\n\n    - NETMASK=255.255.255.0\n\n    - GATEWAY=192.168.2.1\n\n    - DNS1=119.29.29.29\n\n    - ```properties\n    TYPE=\"Ethernet\"\n    PROXY_METHOD=\"none\"\n    BROWSER_ONLY=\"no\"\n    BOOTPROTO=\"static\"\n    DEFROUTE=\"yes\"\n    IPV4_FAILURE_FATAL=\"no\"\n    IPV6INIT=\"yes\"\n    IPV6_AUTOCONF=\"yes\"\n    IPV6_DEFROUTE=\"yes\"\n    IPV6_FAILURE_FATAL=\"no\"\n    IPV6_ADDR_GEN_MODE=\"stable-privacy\"\n    NAME=\"ens33\"\n    UUID=\"deb20895-5574-4f53-89da-d5ccb3a68bf2\"\n    DEVICE=\"ens33\"\n    ONBOOT=\"yes\"\n    IPV6_PRIVACY=\"no\"\n    IPADDR=192.168.2.246\n    NETMASK=255.255.255.0\n    GATEWAY=192.168.2.1\n    DNS1=119.29.29.29\n    ```\n\n\n### 安装Docker、Docker-Compose\n\n```bash\n# 安装docker\n[root@localhost ~]# yum install -y yum-utils device-mapper-persistent-data lvm2\n[root@localhost ~]# yum -y install docker-ce\n[root@localhost ~]# systemctl start docker\n[root@localhost ~]# systemctl enable docker\n# 安装docker-compose\n[root@localhost ~]# yum install docker-compose \n# 查看docker-compose版本信息\n[root@localhost ~]# docker-compose -v\n```\n\n### 双主双从(2M-2S-ASYNC)\n\n> 异步复制性能最佳，但是存在节点故障时，Master无法正常写入Slave导致部分消息丢失\n\n- 部署方式：`Docker`，共享宿主机配置\n\n- 集群配置：`2M-2S-ASYNC`、`2Namesrv`\n\n#### 宿主机创建配置文件，日志目录，用来映射容器中的路径\n\n```bash\n# 创建日志目录文件夹\n[root@localhost conf]# mkdir -p /data/docker/rocketmq/{logs-namesrv-m,logs-namesrv-s,logs-broker-a,store-a,conf,logs-broker-b,store-b,logs-broker-a-s,store-a-s,logs-broker-b-s,store-b-s}\n# 编写主从配置文件\n[root@localhost conf]# vim broker-a.conf\n[root@localhost conf]# vim broker-a-s.conf\n[root@localhost conf]# vim broker-b.conf\n[root@localhost conf]# vim broker-b-s.conf\n```\n\n**broker-a.conf**\n\n```properties\n#所属集群名字，同一个集群名字相同\nbrokerClusterName=rocketmq-cluster\n#broker名字\nbrokerName=broker-a\n#0表示master >0 表示slave\nbrokerId=0\n#删除文件的时间点，凌晨4点\ndeleteWhen=04\n#文件保留时间 默认是48小时\nfileReservedTime=168\n#异步复制Master\nbrokerRole=ASYNC_MASTER\n#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 \nflushDiskType=ASYNC_FLUSH\n#Broker 对外服务的监听端口\nlistenPort=10911\n#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）\nnamesrvAddr=192.168.2.246:9876\n#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡\ndefaultTopicQueueNums=8\n#是否允许 Broker 自动创建Topic，生产建议关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，生产建议关闭\nautoCreateSubscriptionGroup=true\n#设置BrokerIP\nbrokerIP1=192.168.2.246\n```\n\n**broker-a-s.conf**\n\n```properties\n#所属集群名字\nbrokerClusterName=rocketmq-cluster\n#broker名字，注意此处不同的配置文件填写的不一样  例如：在a.properties 文件中写 broker-a  在b.properties 文件中写 broker-b\nbrokerName=broker-a\n#0 表示 Master，>0 表示 Slave\nbrokerId=1\n#删除文件时间点，默认凌晨 4点\ndeleteWhen=04\n#文件保留时间，默认 48 小时\nfileReservedTime=168\n#Broker 的角色，ASYNC_MASTER=异步复制Master，SYNC_MASTER=同步双写Master，SLAVE=slave节点\nbrokerRole=SLAVE\n#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 \nflushDiskType=SYNC_FLUSH\n#Broker 对外服务的监听端口\nlistenPort=12911\n#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）\nnamesrvAddr=192.168.2.246:9876\n#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡\ndefaultTopicQueueNums=8\n#是否允许 Broker 自动创建Topic，生产建议关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，生产建议关闭\nautoCreateSubscriptionGroup=true\n#设置BrokerIP\nbrokerIP1=192.168.2.246\n\n```\n\n**broker-b.conf**\n\n```properties\n#所属集群名字\nbrokerClusterName=rocketmq-cluster\n#broker名字，注意此处不同的配置文件填写的不一样  例如：在a.properties 文件中写 broker-a  在b.properties 文件中写 broker-b\nbrokerName=broker-b\n#0 表示 Master，>0 表示 Slave\nbrokerId=0\n#删除文件时间点，默认凌晨 4点\ndeleteWhen=04\n#文件保留时间，默认 48 小时\nfileReservedTime=168\n#Broker 的角色，ASYNC_MASTER=异步复制Master，SYNC_MASTER=同步双写Master，SLAVE=slave节点\nbrokerRole=ASYNC_MASTER\n#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 \nflushDiskType=SYNC_FLUSH\n#Broker 对外服务的监听端口\nlistenPort=11911\n#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）\nnamesrvAddr=192.168.2.246:9876\n#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡\ndefaultTopicQueueNums=8\n#是否允许 Broker 自动创建Topic，生产建议关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，生产建议关闭\nautoCreateSubscriptionGroup=true\n#设置BrokerIP\nbrokerIP1=192.168.2.246\n```\n\n**broker-b-s.conf**\n\n```properties\n#所属集群名字\nbrokerClusterName=rocketmq-cluster\nbrokerName=broker-b\n#slave\nbrokerId=1\ndeleteWhen=04\nfileReservedTime=168\nbrokerRole=SLAVE\nflushDiskType=ASYNC_FLUSH\n#Broker 对外服务的监听端口\nlistenPort=13911\n#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）\nnamesrvAddr=192.168.2.246:9876\n#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡\ndefaultTopicQueueNums=8\n#是否允许 Broker 自动创建Topic，生产建议关闭\nautoCreateTopicEnable=true\n#是否允许 Broker 自动创建订阅组，生产建议关闭\nautoCreateSubscriptionGroup=true\n#设置BrokerIP\nbrokerIP1=192.168.2.246\n```\n\n#### 构建docker-compose.yml配置文件\n\n```yaml\nversion: '2'\nservices:\n  namesrv1:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: namesrv1\n    ports:\n      - 9876:9876\n    volumes:\n      - /data/docker/rocketmq/logs-namesrv-m:/home/rocketmq/logs\n    environment:\n      JAVA_OPT_EXT: -server -Xms256M -Xmx256M -Xmn128m\n    command: sh mqnamesrv\n  broker-a-m:\n      image: foxiswho/rocketmq:4.8.0\n      container_name: broker-a-master\n      ports:\n        - 10909:10909\n        - 10911:10911\n        - 10912:10912\n      volumes:\n      - /data/docker/rocketmq/logs-broker-a:/home/rocketmq/logs\n      - /data/docker/rocketmq/store-a:/home/rocketmq/store\n      - /data/docker/rocketmq/conf/broker-a.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n      environment:\n        JAVA_OPT_EXT: -server -Xms256m -Xmx256m -Xmn128m\n        NAMESRV_ADDR: 192.168.2.246:9876\n      command: sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n  broker-b-m:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: broker-b-master\n    ports:\n      - 11909:11909\n      - 11911:11911\n      - 11912:11912\n    volumes:\n    - /data/docker/rocketmq/logs-broker-b:/home/rocketmq/logs\n    - /data/docker/rocketmq/store-b:/home/rocketmq/store\n    - /data/docker/rocketmq/conf/broker-b.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n    environment:\n      JAVA_OPT_EXT: -server -Xms256m -Xmx256m -Xmn128m\n      NAMESRV_ADDR: 192.168.2.246:9876\n    command: sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n  broker-a-s:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: broker-a-slave\n    ports:\n      - 12909:12909\n      - 12911:12911\n      - 12912:12912\n    volumes:\n      - /data/docker/rocketmq/logs-broker-a-s:/home/rocketmq/logs\n      - /data/docker/rocketmq/store-a-s:/home/rocketmq/store\n      - /data/docker/rocketmq/conf/broker-a-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n    environment:\n      JAVA_OPT_EXT: -server -Xms256m -Xmx256m -Xmn128m\n      NAMESRV_ADDR: 192.168.2.246:9876\n    command: sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n  broker-b-s:\n    image: foxiswho/rocketmq:4.8.0\n    container_name: broker-b-slave\n    ports:\n      - 13909:13909\n      - 13911:13911\n      - 13912:13912\n    volumes:\n      - /data/docker/rocketmq/logs-broker-b-s:/home/rocketmq/logs\n      - /data/docker/rocketmq/store-b-s:/home/rocketmq/store\n      - /data/docker/rocketmq/conf/broker-b-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n    environment:\n      JAVA_OPT_EXT: -server -Xms256m -Xmx256m -Xmn128m\n      NAMESRV_ADDR: 192.168.2.246:9876\n    command: sh mqbroker  -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf\n    depends_on:\n      - namesrv1\n```\n\n#### 主从节点配置信息\n\n| System Info  | IP:PORT               | BrokerId |\n| ------------ | --------------------- | -------- |\n| `namesrv1`   | 192.168.2.246:`9876`  |          |\n| `broker-a`   | 192.168.2.246:`10911` | 0        |\n| `broker-a-s` | 192.168.2.246:`12911` | 1        |\n| `broker-b`   | 192.168.2.246:`11911` | 0        |\n| `broker-b-s` | 192.168.2.246:`13911` | 1        |\n\n#### Docker容器分布\n\n![image-20220820204340646](https://img.lattice.vip/typora/2022/image-20220820204340646.png)\n\n### 部署RocketMQ-Console\n\n获取RocketMQ-Console镜像，连接NameServer中心，新版本以及迁移到新的Repo,名称为RockeMQ-Dashboard\n\n```bash\n# 拉取控制台镜像\nlattice@lattice-cluster-01:/$docker pull styletang/rocketmq-console-ng\n# 启动容器\nlattice@lattice-cluster-01:/$docker run -d -e \"JAVA_OPTS=-Drocketmq.config.namesrvAddr=192.168.2.246:9876 -Drocketmq.config.isVIPChannel=false\" -p 8088:8080 -t styletang/rocketmq-console-ng    \n```\n\n部署成功界面\n\n![image-20220819082950746](https://img.lattice.vip/typora/2022/image-20220819082950746.png)\n\n### 遇到的问题\n\n- broker exited 253\n\n    - 最终定位下来问题原因，映射到宿主机的目录卷权限不够，无法应用broker等的配置文件，以及无法操作日志目录\n\n- 宿主机普通用户每次操作docker命令都需要指定sudo，甚是麻烦\n\n    - 解决方案：加入docker组\n\n    - ```bash\n    sudo usermod -aG docker xxx\n    ```\n\n- 一直报file path的问题，需要手动创建对应目录\n\n    - ```\n    mkdir /data/docker/rocketmq/store-a/commitlog/\n    mkdir /data/docker/rocketmq/store-a/consumequeue/\n    ```\n\n- 搭建集群的过程中确实有遇到一些莫名其妙的问题，例如 Namesrv 最开始部署了两台，9876/9877 ，最终却连不上 9877 ，后来便放弃，使用单节点 Namesrv","slug":"RocketMQ-Cluster","published":1,"updated":"2022-08-26T08:16:30.539Z","_id":"cl78v0x5q00016c7e46tg3dq5","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"向往的开发环境搭建（一）：RocketMQ-Cluster\"><a href=\"#向往的开发环境搭建（一）：RocketMQ-Cluster\" class=\"headerlink\" title=\"向往的开发环境搭建（一）：RocketMQ Cluster\"></a>向往的开发环境搭建（一）：RocketMQ Cluster</h2><blockquote>\n<p>本文基于Docker虚拟化容器技术，实现一台虚拟机作为宿主机，安装Docker环境部署RocketMQ（2M-2S-Namesrv）集群环境</p>\n</blockquote>\n<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><ul>\n<li>前文回顾<ul>\n<li><a href=\"https://v2ex.com/t/870873\">I5-12600KF | 升级老式台式机</a></li>\n<li><a href=\"https://v2ex.com/t/871352\">装机后续：i7-12700 + 华硕 B660M 重炮手装机实操</a></li>\n</ul>\n</li>\n<li>继台式机组装完成后，便开始在脑子中有一个想法：搭建一个程序员必备 /向往的开发环境，最终的蓝图是希望能最大化利用台式机的性能，开机后即可拥有一套现成的本地“云”开发集群环境</li>\n<li>第一篇便从最近学习的 RocketMQ 出发，基于 Docker 虚拟化容器技术，实现一台虚拟机作为宿主机，安装 Docker 环境部署 RocketMQ （ 2M-2S-Namesrv ）集群环境</li>\n<li>后续可能会考虑搭建 MySQL 主从、Redis 等中间件集群环境，用以分享学习交流~</li>\n</ul>\n<h3 id=\"虚拟机环境\"><a href=\"#虚拟机环境\" class=\"headerlink\" title=\"虚拟机环境\"></a>虚拟机环境</h3><ul>\n<li><p>官网下载 Centos7 ISO 镜像文件 【CentOS-7-x86_64-Minimal-2207-02】 <a href=\"https://mirrors.tuna.tsinghua.edu.cn/centos/7.9.2009/isos/x86_64/\">清华大学CentOS-7镜像站</a></p>\n</li>\n<li><p>启动VamwarePro安装Centos7</p>\n</li>\n<li><p>配置虚拟机参数</p>\n<ul>\n<li>4核/16G/80G-SSD</li>\n<li>IP: 192.168.2.246</li>\n</ul>\n</li>\n<li><p>静态IP配置，vim /etc/sysconfig/network-scripts/ifcfg-ens33</p>\n<ul>\n<li><p>BOOTPROTO=”static”</p>\n</li>\n<li><p>IPADDR=192.168.2.246</p>\n</li>\n<li><p>NETMASK=255.255.255.0</p>\n</li>\n<li><p>GATEWAY=192.168.2.1</p>\n</li>\n<li><p>DNS1=119.29.29.29</p>\n</li>\n<li><p>```properties<br>TYPE=”Ethernet”<br>PROXY_METHOD=”none”<br>BROWSER_ONLY=”no”<br>BOOTPROTO=”static”<br>DEFROUTE=”yes”<br>IPV4_FAILURE_FATAL=”no”<br>IPV6INIT=”yes”<br>IPV6_AUTOCONF=”yes”<br>IPV6_DEFROUTE=”yes”<br>IPV6_FAILURE_FATAL=”no”<br>IPV6_ADDR_GEN_MODE=”stable-privacy”<br>NAME=”ens33”<br>UUID=”deb20895-5574-4f53-89da-d5ccb3a68bf2”<br>DEVICE=”ens33”<br>ONBOOT=”yes”<br>IPV6_PRIVACY=”no”<br>IPADDR=192.168.2.246<br>NETMASK=255.255.255.0<br>GATEWAY=192.168.2.1<br>DNS1=119.29.29.29</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">### 安装Docker、Docker-Compose</span><br><span class=\"line\"></span><br><span class=\"line\">```bash</span><br><span class=\"line\"># 安装docker</span><br><span class=\"line\">[root@localhost ~]# yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class=\"line\">[root@localhost ~]# yum -y install docker-ce</span><br><span class=\"line\">[root@localhost ~]# systemctl start docker</span><br><span class=\"line\">[root@localhost ~]# systemctl enable docker</span><br><span class=\"line\"># 安装docker-compose</span><br><span class=\"line\">[root@localhost ~]# yum install docker-compose </span><br><span class=\"line\"># 查看docker-compose版本信息</span><br><span class=\"line\">[root@localhost ~]# docker-compose -v</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"双主双从-2M-2S-ASYNC\"><a href=\"#双主双从-2M-2S-ASYNC\" class=\"headerlink\" title=\"双主双从(2M-2S-ASYNC)\"></a>双主双从(2M-2S-ASYNC)</h3><blockquote>\n<p>异步复制性能最佳，但是存在节点故障时，Master无法正常写入Slave导致部分消息丢失</p>\n</blockquote>\n<ul>\n<li><p>部署方式：<code>Docker</code>，共享宿主机配置</p>\n</li>\n<li><p>集群配置：<code>2M-2S-ASYNC</code>、<code>2Namesrv</code></p>\n</li>\n</ul>\n<h4 id=\"宿主机创建配置文件，日志目录，用来映射容器中的路径\"><a href=\"#宿主机创建配置文件，日志目录，用来映射容器中的路径\" class=\"headerlink\" title=\"宿主机创建配置文件，日志目录，用来映射容器中的路径\"></a>宿主机创建配置文件，日志目录，用来映射容器中的路径</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建日志目录文件夹</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># mkdir -p /data/docker/rocketmq/&#123;logs-namesrv-m,logs-namesrv-s,logs-broker-a,store-a,conf,logs-broker-b,store-b,logs-broker-a-s,store-a-s,logs-broker-b-s,store-b-s&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># 编写主从配置文件</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># vim broker-a.conf</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># vim broker-a-s.conf</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># vim broker-b.conf</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># vim broker-b-s.conf</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>broker-a.conf</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#所属集群名字，同一个集群名字相同</span></span><br><span class=\"line\"><span class=\"attr\">brokerClusterName</span>=<span class=\"string\">rocketmq-cluster</span></span><br><span class=\"line\"><span class=\"comment\">#broker名字</span></span><br><span class=\"line\"><span class=\"attr\">brokerName</span>=<span class=\"string\">broker-a</span></span><br><span class=\"line\"><span class=\"comment\">#0表示master &gt;0 表示slave</span></span><br><span class=\"line\"><span class=\"attr\">brokerId</span>=<span class=\"string\">0</span></span><br><span class=\"line\"><span class=\"comment\">#删除文件的时间点，凌晨4点</span></span><br><span class=\"line\"><span class=\"attr\">deleteWhen</span>=<span class=\"string\">04</span></span><br><span class=\"line\"><span class=\"comment\">#文件保留时间 默认是48小时</span></span><br><span class=\"line\"><span class=\"attr\">fileReservedTime</span>=<span class=\"string\">168</span></span><br><span class=\"line\"><span class=\"comment\">#异步复制Master</span></span><br><span class=\"line\"><span class=\"attr\">brokerRole</span>=<span class=\"string\">ASYNC_MASTER</span></span><br><span class=\"line\"><span class=\"comment\">#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 </span></span><br><span class=\"line\"><span class=\"attr\">flushDiskType</span>=<span class=\"string\">ASYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 对外服务的监听端口</span></span><br><span class=\"line\"><span class=\"attr\">listenPort</span>=<span class=\"string\">10911</span></span><br><span class=\"line\"><span class=\"comment\">#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）</span></span><br><span class=\"line\"><span class=\"attr\">namesrvAddr</span>=<span class=\"string\">192.168.2.246:9876</span></span><br><span class=\"line\"><span class=\"comment\">#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡</span></span><br><span class=\"line\"><span class=\"attr\">defaultTopicQueueNums</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建Topic，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateTopicEnable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建订阅组，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateSubscriptionGroup</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置BrokerIP</span></span><br><span class=\"line\"><span class=\"attr\">brokerIP1</span>=<span class=\"string\">192.168.2.246</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>broker-a-s.conf</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#所属集群名字</span></span><br><span class=\"line\"><span class=\"attr\">brokerClusterName</span>=<span class=\"string\">rocketmq-cluster</span></span><br><span class=\"line\"><span class=\"comment\">#broker名字，注意此处不同的配置文件填写的不一样  例如：在a.properties 文件中写 broker-a  在b.properties 文件中写 broker-b</span></span><br><span class=\"line\"><span class=\"attr\">brokerName</span>=<span class=\"string\">broker-a</span></span><br><span class=\"line\"><span class=\"comment\">#0 表示 Master，&gt;0 表示 Slave</span></span><br><span class=\"line\"><span class=\"attr\">brokerId</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"comment\">#删除文件时间点，默认凌晨 4点</span></span><br><span class=\"line\"><span class=\"attr\">deleteWhen</span>=<span class=\"string\">04</span></span><br><span class=\"line\"><span class=\"comment\">#文件保留时间，默认 48 小时</span></span><br><span class=\"line\"><span class=\"attr\">fileReservedTime</span>=<span class=\"string\">168</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 的角色，ASYNC_MASTER=异步复制Master，SYNC_MASTER=同步双写Master，SLAVE=slave节点</span></span><br><span class=\"line\"><span class=\"attr\">brokerRole</span>=<span class=\"string\">SLAVE</span></span><br><span class=\"line\"><span class=\"comment\">#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 </span></span><br><span class=\"line\"><span class=\"attr\">flushDiskType</span>=<span class=\"string\">SYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 对外服务的监听端口</span></span><br><span class=\"line\"><span class=\"attr\">listenPort</span>=<span class=\"string\">12911</span></span><br><span class=\"line\"><span class=\"comment\">#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）</span></span><br><span class=\"line\"><span class=\"attr\">namesrvAddr</span>=<span class=\"string\">192.168.2.246:9876</span></span><br><span class=\"line\"><span class=\"comment\">#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡</span></span><br><span class=\"line\"><span class=\"attr\">defaultTopicQueueNums</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建Topic，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateTopicEnable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建订阅组，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateSubscriptionGroup</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置BrokerIP</span></span><br><span class=\"line\"><span class=\"attr\">brokerIP1</span>=<span class=\"string\">192.168.2.246</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>broker-b.conf</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#所属集群名字</span></span><br><span class=\"line\"><span class=\"attr\">brokerClusterName</span>=<span class=\"string\">rocketmq-cluster</span></span><br><span class=\"line\"><span class=\"comment\">#broker名字，注意此处不同的配置文件填写的不一样  例如：在a.properties 文件中写 broker-a  在b.properties 文件中写 broker-b</span></span><br><span class=\"line\"><span class=\"attr\">brokerName</span>=<span class=\"string\">broker-b</span></span><br><span class=\"line\"><span class=\"comment\">#0 表示 Master，&gt;0 表示 Slave</span></span><br><span class=\"line\"><span class=\"attr\">brokerId</span>=<span class=\"string\">0</span></span><br><span class=\"line\"><span class=\"comment\">#删除文件时间点，默认凌晨 4点</span></span><br><span class=\"line\"><span class=\"attr\">deleteWhen</span>=<span class=\"string\">04</span></span><br><span class=\"line\"><span class=\"comment\">#文件保留时间，默认 48 小时</span></span><br><span class=\"line\"><span class=\"attr\">fileReservedTime</span>=<span class=\"string\">168</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 的角色，ASYNC_MASTER=异步复制Master，SYNC_MASTER=同步双写Master，SLAVE=slave节点</span></span><br><span class=\"line\"><span class=\"attr\">brokerRole</span>=<span class=\"string\">ASYNC_MASTER</span></span><br><span class=\"line\"><span class=\"comment\">#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 </span></span><br><span class=\"line\"><span class=\"attr\">flushDiskType</span>=<span class=\"string\">SYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 对外服务的监听端口</span></span><br><span class=\"line\"><span class=\"attr\">listenPort</span>=<span class=\"string\">11911</span></span><br><span class=\"line\"><span class=\"comment\">#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）</span></span><br><span class=\"line\"><span class=\"attr\">namesrvAddr</span>=<span class=\"string\">192.168.2.246:9876</span></span><br><span class=\"line\"><span class=\"comment\">#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡</span></span><br><span class=\"line\"><span class=\"attr\">defaultTopicQueueNums</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建Topic，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateTopicEnable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建订阅组，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateSubscriptionGroup</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置BrokerIP</span></span><br><span class=\"line\"><span class=\"attr\">brokerIP1</span>=<span class=\"string\">192.168.2.246</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>broker-b-s.conf</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#所属集群名字</span></span><br><span class=\"line\"><span class=\"attr\">brokerClusterName</span>=<span class=\"string\">rocketmq-cluster</span></span><br><span class=\"line\"><span class=\"attr\">brokerName</span>=<span class=\"string\">broker-b</span></span><br><span class=\"line\"><span class=\"comment\">#slave</span></span><br><span class=\"line\"><span class=\"attr\">brokerId</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"attr\">deleteWhen</span>=<span class=\"string\">04</span></span><br><span class=\"line\"><span class=\"attr\">fileReservedTime</span>=<span class=\"string\">168</span></span><br><span class=\"line\"><span class=\"attr\">brokerRole</span>=<span class=\"string\">SLAVE</span></span><br><span class=\"line\"><span class=\"attr\">flushDiskType</span>=<span class=\"string\">ASYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 对外服务的监听端口</span></span><br><span class=\"line\"><span class=\"attr\">listenPort</span>=<span class=\"string\">13911</span></span><br><span class=\"line\"><span class=\"comment\">#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）</span></span><br><span class=\"line\"><span class=\"attr\">namesrvAddr</span>=<span class=\"string\">192.168.2.246:9876</span></span><br><span class=\"line\"><span class=\"comment\">#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡</span></span><br><span class=\"line\"><span class=\"attr\">defaultTopicQueueNums</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建Topic，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateTopicEnable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建订阅组，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateSubscriptionGroup</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置BrokerIP</span></span><br><span class=\"line\"><span class=\"attr\">brokerIP1</span>=<span class=\"string\">192.168.2.246</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"构建docker-compose-yml配置文件\"><a href=\"#构建docker-compose-yml配置文件\" class=\"headerlink\" title=\"构建docker-compose.yml配置文件\"></a>构建docker-compose.yml配置文件</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;2&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">namesrv1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">namesrv1</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9876</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-namesrv-m:/home/rocketmq/logs</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256M</span> <span class=\"string\">-Xmx256M</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqnamesrv</span></span><br><span class=\"line\">  <span class=\"attr\">broker-a-m:</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">      <span class=\"attr\">container_name:</span> <span class=\"string\">broker-a-master</span></span><br><span class=\"line\">      <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">10909</span><span class=\"string\">:10909</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">10911</span><span class=\"string\">:10911</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">10912</span><span class=\"string\">:10912</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-broker-a:/home/rocketmq/logs</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/store-a:/home/rocketmq/store</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/conf/broker-a.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">      <span class=\"attr\">environment:</span></span><br><span class=\"line\">        <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256m</span> <span class=\"string\">-Xmx256m</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">        <span class=\"attr\">NAMESRV_ADDR:</span> <span class=\"number\">192.168</span><span class=\"number\">.2</span><span class=\"number\">.246</span><span class=\"string\">:9876</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqbroker</span>  <span class=\"string\">-c</span> <span class=\"string\">/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">  <span class=\"attr\">broker-b-m:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">broker-b-master</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">11909</span><span class=\"string\">:11909</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">11911</span><span class=\"string\">:11911</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">11912</span><span class=\"string\">:11912</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-broker-b:/home/rocketmq/logs</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/store-b:/home/rocketmq/store</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/conf/broker-b.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256m</span> <span class=\"string\">-Xmx256m</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">      <span class=\"attr\">NAMESRV_ADDR:</span> <span class=\"number\">192.168</span><span class=\"number\">.2</span><span class=\"number\">.246</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqbroker</span>  <span class=\"string\">-c</span> <span class=\"string\">/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">  <span class=\"attr\">broker-a-s:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">broker-a-slave</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">12909</span><span class=\"string\">:12909</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">12911</span><span class=\"string\">:12911</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">12912</span><span class=\"string\">:12912</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-broker-a-s:/home/rocketmq/logs</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/store-a-s:/home/rocketmq/store</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/conf/broker-a-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256m</span> <span class=\"string\">-Xmx256m</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">      <span class=\"attr\">NAMESRV_ADDR:</span> <span class=\"number\">192.168</span><span class=\"number\">.2</span><span class=\"number\">.246</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqbroker</span>  <span class=\"string\">-c</span> <span class=\"string\">/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">  <span class=\"attr\">broker-b-s:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">broker-b-slave</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">13909</span><span class=\"string\">:13909</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">13911</span><span class=\"string\">:13911</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">13912</span><span class=\"string\">:13912</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-broker-b-s:/home/rocketmq/logs</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/store-b-s:/home/rocketmq/store</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/conf/broker-b-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256m</span> <span class=\"string\">-Xmx256m</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">      <span class=\"attr\">NAMESRV_ADDR:</span> <span class=\"number\">192.168</span><span class=\"number\">.2</span><span class=\"number\">.246</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqbroker</span>  <span class=\"string\">-c</span> <span class=\"string\">/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">namesrv1</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"主从节点配置信息\"><a href=\"#主从节点配置信息\" class=\"headerlink\" title=\"主从节点配置信息\"></a>主从节点配置信息</h4><table>\n<thead>\n<tr>\n<th>System Info</th>\n<th>IP:PORT</th>\n<th>BrokerId</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>namesrv1</code></td>\n<td>192.168.2.246:<code>9876</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code>broker-a</code></td>\n<td>192.168.2.246:<code>10911</code></td>\n<td>0</td>\n</tr>\n<tr>\n<td><code>broker-a-s</code></td>\n<td>192.168.2.246:<code>12911</code></td>\n<td>1</td>\n</tr>\n<tr>\n<td><code>broker-b</code></td>\n<td>192.168.2.246:<code>11911</code></td>\n<td>0</td>\n</tr>\n<tr>\n<td><code>broker-b-s</code></td>\n<td>192.168.2.246:<code>13911</code></td>\n<td>1</td>\n</tr>\n</tbody></table>\n<h4 id=\"Docker容器分布\"><a href=\"#Docker容器分布\" class=\"headerlink\" title=\"Docker容器分布\"></a>Docker容器分布</h4><p><img src=\"https://img.lattice.vip/typora/2022/image-20220820204340646.png\" alt=\"image-20220820204340646\"></p>\n<h3 id=\"部署RocketMQ-Console\"><a href=\"#部署RocketMQ-Console\" class=\"headerlink\" title=\"部署RocketMQ-Console\"></a>部署RocketMQ-Console</h3><p>获取RocketMQ-Console镜像，连接NameServer中心，新版本以及迁移到新的Repo,名称为RockeMQ-Dashboard</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 拉取控制台镜像</span></span><br><span class=\"line\">lattice@lattice-cluster-01:/<span class=\"variable\">$docker</span> pull styletang/rocketmq-console-ng</span><br><span class=\"line\"><span class=\"comment\"># 启动容器</span></span><br><span class=\"line\">lattice@lattice-cluster-01:/<span class=\"variable\">$docker</span> run -d -e <span class=\"string\">&quot;JAVA_OPTS=-Drocketmq.config.namesrvAddr=192.168.2.246:9876 -Drocketmq.config.isVIPChannel=false&quot;</span> -p 8088:8080 -t styletang/rocketmq-console-ng    </span><br></pre></td></tr></table></figure>\n\n<p>部署成功界面</p>\n<p><img src=\"https://img.lattice.vip/typora/2022/image-20220819082950746.png\" alt=\"image-20220819082950746\"></p>\n<h3 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h3><ul>\n<li><p>broker exited 253</p>\n<ul>\n<li>最终定位下来问题原因，映射到宿主机的目录卷权限不够，无法应用broker等的配置文件，以及无法操作日志目录</li>\n</ul>\n</li>\n<li><p>宿主机普通用户每次操作docker命令都需要指定sudo，甚是麻烦</p>\n<ul>\n<li><p>解决方案：加入docker组</p>\n</li>\n<li><p>```bash<br>sudo usermod -aG docker xxx</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- 一直报file path的问题，需要手动创建对应目录</span><br><span class=\"line\"></span><br><span class=\"line\">    - ```</span><br><span class=\"line\">    mkdir /data/docker/rocketmq/store-a/commitlog/</span><br><span class=\"line\">    mkdir /data/docker/rocketmq/store-a/consumequeue/</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>搭建集群的过程中确实有遇到一些莫名其妙的问题，例如 Namesrv 最开始部署了两台，9876/9877 ，最终却连不上 9877 ，后来便放弃，使用单节点 Namesrv</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"向往的开发环境搭建（一）：RocketMQ-Cluster\"><a href=\"#向往的开发环境搭建（一）：RocketMQ-Cluster\" class=\"headerlink\" title=\"向往的开发环境搭建（一）：RocketMQ Cluster\"></a>向往的开发环境搭建（一）：RocketMQ Cluster</h2><blockquote>\n<p>本文基于Docker虚拟化容器技术，实现一台虚拟机作为宿主机，安装Docker环境部署RocketMQ（2M-2S-Namesrv）集群环境</p>\n</blockquote>\n<h3 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h3><ul>\n<li>前文回顾<ul>\n<li><a href=\"https://v2ex.com/t/870873\">I5-12600KF | 升级老式台式机</a></li>\n<li><a href=\"https://v2ex.com/t/871352\">装机后续：i7-12700 + 华硕 B660M 重炮手装机实操</a></li>\n</ul>\n</li>\n<li>继台式机组装完成后，便开始在脑子中有一个想法：搭建一个程序员必备 /向往的开发环境，最终的蓝图是希望能最大化利用台式机的性能，开机后即可拥有一套现成的本地“云”开发集群环境</li>\n<li>第一篇便从最近学习的 RocketMQ 出发，基于 Docker 虚拟化容器技术，实现一台虚拟机作为宿主机，安装 Docker 环境部署 RocketMQ （ 2M-2S-Namesrv ）集群环境</li>\n<li>后续可能会考虑搭建 MySQL 主从、Redis 等中间件集群环境，用以分享学习交流~</li>\n</ul>\n<h3 id=\"虚拟机环境\"><a href=\"#虚拟机环境\" class=\"headerlink\" title=\"虚拟机环境\"></a>虚拟机环境</h3><ul>\n<li><p>官网下载 Centos7 ISO 镜像文件 【CentOS-7-x86_64-Minimal-2207-02】 <a href=\"https://mirrors.tuna.tsinghua.edu.cn/centos/7.9.2009/isos/x86_64/\">清华大学CentOS-7镜像站</a></p>\n</li>\n<li><p>启动VamwarePro安装Centos7</p>\n</li>\n<li><p>配置虚拟机参数</p>\n<ul>\n<li>4核/16G/80G-SSD</li>\n<li>IP: 192.168.2.246</li>\n</ul>\n</li>\n<li><p>静态IP配置，vim /etc/sysconfig/network-scripts/ifcfg-ens33</p>\n<ul>\n<li><p>BOOTPROTO=”static”</p>\n</li>\n<li><p>IPADDR=192.168.2.246</p>\n</li>\n<li><p>NETMASK=255.255.255.0</p>\n</li>\n<li><p>GATEWAY=192.168.2.1</p>\n</li>\n<li><p>DNS1=119.29.29.29</p>\n</li>\n<li><p>```properties<br>TYPE=”Ethernet”<br>PROXY_METHOD=”none”<br>BROWSER_ONLY=”no”<br>BOOTPROTO=”static”<br>DEFROUTE=”yes”<br>IPV4_FAILURE_FATAL=”no”<br>IPV6INIT=”yes”<br>IPV6_AUTOCONF=”yes”<br>IPV6_DEFROUTE=”yes”<br>IPV6_FAILURE_FATAL=”no”<br>IPV6_ADDR_GEN_MODE=”stable-privacy”<br>NAME=”ens33”<br>UUID=”deb20895-5574-4f53-89da-d5ccb3a68bf2”<br>DEVICE=”ens33”<br>ONBOOT=”yes”<br>IPV6_PRIVACY=”no”<br>IPADDR=192.168.2.246<br>NETMASK=255.255.255.0<br>GATEWAY=192.168.2.1<br>DNS1=119.29.29.29</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">### 安装Docker、Docker-Compose</span><br><span class=\"line\"></span><br><span class=\"line\">```bash</span><br><span class=\"line\"># 安装docker</span><br><span class=\"line\">[root@localhost ~]# yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class=\"line\">[root@localhost ~]# yum -y install docker-ce</span><br><span class=\"line\">[root@localhost ~]# systemctl start docker</span><br><span class=\"line\">[root@localhost ~]# systemctl enable docker</span><br><span class=\"line\"># 安装docker-compose</span><br><span class=\"line\">[root@localhost ~]# yum install docker-compose </span><br><span class=\"line\"># 查看docker-compose版本信息</span><br><span class=\"line\">[root@localhost ~]# docker-compose -v</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"双主双从-2M-2S-ASYNC\"><a href=\"#双主双从-2M-2S-ASYNC\" class=\"headerlink\" title=\"双主双从(2M-2S-ASYNC)\"></a>双主双从(2M-2S-ASYNC)</h3><blockquote>\n<p>异步复制性能最佳，但是存在节点故障时，Master无法正常写入Slave导致部分消息丢失</p>\n</blockquote>\n<ul>\n<li><p>部署方式：<code>Docker</code>，共享宿主机配置</p>\n</li>\n<li><p>集群配置：<code>2M-2S-ASYNC</code>、<code>2Namesrv</code></p>\n</li>\n</ul>\n<h4 id=\"宿主机创建配置文件，日志目录，用来映射容器中的路径\"><a href=\"#宿主机创建配置文件，日志目录，用来映射容器中的路径\" class=\"headerlink\" title=\"宿主机创建配置文件，日志目录，用来映射容器中的路径\"></a>宿主机创建配置文件，日志目录，用来映射容器中的路径</h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 创建日志目录文件夹</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># mkdir -p /data/docker/rocketmq/&#123;logs-namesrv-m,logs-namesrv-s,logs-broker-a,store-a,conf,logs-broker-b,store-b,logs-broker-a-s,store-a-s,logs-broker-b-s,store-b-s&#125;</span></span><br><span class=\"line\"><span class=\"comment\"># 编写主从配置文件</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># vim broker-a.conf</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># vim broker-a-s.conf</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># vim broker-b.conf</span></span><br><span class=\"line\">[root@localhost conf]<span class=\"comment\"># vim broker-b-s.conf</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>broker-a.conf</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#所属集群名字，同一个集群名字相同</span></span><br><span class=\"line\"><span class=\"attr\">brokerClusterName</span>=<span class=\"string\">rocketmq-cluster</span></span><br><span class=\"line\"><span class=\"comment\">#broker名字</span></span><br><span class=\"line\"><span class=\"attr\">brokerName</span>=<span class=\"string\">broker-a</span></span><br><span class=\"line\"><span class=\"comment\">#0表示master &gt;0 表示slave</span></span><br><span class=\"line\"><span class=\"attr\">brokerId</span>=<span class=\"string\">0</span></span><br><span class=\"line\"><span class=\"comment\">#删除文件的时间点，凌晨4点</span></span><br><span class=\"line\"><span class=\"attr\">deleteWhen</span>=<span class=\"string\">04</span></span><br><span class=\"line\"><span class=\"comment\">#文件保留时间 默认是48小时</span></span><br><span class=\"line\"><span class=\"attr\">fileReservedTime</span>=<span class=\"string\">168</span></span><br><span class=\"line\"><span class=\"comment\">#异步复制Master</span></span><br><span class=\"line\"><span class=\"attr\">brokerRole</span>=<span class=\"string\">ASYNC_MASTER</span></span><br><span class=\"line\"><span class=\"comment\">#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 </span></span><br><span class=\"line\"><span class=\"attr\">flushDiskType</span>=<span class=\"string\">ASYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 对外服务的监听端口</span></span><br><span class=\"line\"><span class=\"attr\">listenPort</span>=<span class=\"string\">10911</span></span><br><span class=\"line\"><span class=\"comment\">#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）</span></span><br><span class=\"line\"><span class=\"attr\">namesrvAddr</span>=<span class=\"string\">192.168.2.246:9876</span></span><br><span class=\"line\"><span class=\"comment\">#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡</span></span><br><span class=\"line\"><span class=\"attr\">defaultTopicQueueNums</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建Topic，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateTopicEnable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建订阅组，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateSubscriptionGroup</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置BrokerIP</span></span><br><span class=\"line\"><span class=\"attr\">brokerIP1</span>=<span class=\"string\">192.168.2.246</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>broker-a-s.conf</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#所属集群名字</span></span><br><span class=\"line\"><span class=\"attr\">brokerClusterName</span>=<span class=\"string\">rocketmq-cluster</span></span><br><span class=\"line\"><span class=\"comment\">#broker名字，注意此处不同的配置文件填写的不一样  例如：在a.properties 文件中写 broker-a  在b.properties 文件中写 broker-b</span></span><br><span class=\"line\"><span class=\"attr\">brokerName</span>=<span class=\"string\">broker-a</span></span><br><span class=\"line\"><span class=\"comment\">#0 表示 Master，&gt;0 表示 Slave</span></span><br><span class=\"line\"><span class=\"attr\">brokerId</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"comment\">#删除文件时间点，默认凌晨 4点</span></span><br><span class=\"line\"><span class=\"attr\">deleteWhen</span>=<span class=\"string\">04</span></span><br><span class=\"line\"><span class=\"comment\">#文件保留时间，默认 48 小时</span></span><br><span class=\"line\"><span class=\"attr\">fileReservedTime</span>=<span class=\"string\">168</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 的角色，ASYNC_MASTER=异步复制Master，SYNC_MASTER=同步双写Master，SLAVE=slave节点</span></span><br><span class=\"line\"><span class=\"attr\">brokerRole</span>=<span class=\"string\">SLAVE</span></span><br><span class=\"line\"><span class=\"comment\">#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 </span></span><br><span class=\"line\"><span class=\"attr\">flushDiskType</span>=<span class=\"string\">SYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 对外服务的监听端口</span></span><br><span class=\"line\"><span class=\"attr\">listenPort</span>=<span class=\"string\">12911</span></span><br><span class=\"line\"><span class=\"comment\">#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）</span></span><br><span class=\"line\"><span class=\"attr\">namesrvAddr</span>=<span class=\"string\">192.168.2.246:9876</span></span><br><span class=\"line\"><span class=\"comment\">#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡</span></span><br><span class=\"line\"><span class=\"attr\">defaultTopicQueueNums</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建Topic，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateTopicEnable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建订阅组，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateSubscriptionGroup</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置BrokerIP</span></span><br><span class=\"line\"><span class=\"attr\">brokerIP1</span>=<span class=\"string\">192.168.2.246</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><strong>broker-b.conf</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#所属集群名字</span></span><br><span class=\"line\"><span class=\"attr\">brokerClusterName</span>=<span class=\"string\">rocketmq-cluster</span></span><br><span class=\"line\"><span class=\"comment\">#broker名字，注意此处不同的配置文件填写的不一样  例如：在a.properties 文件中写 broker-a  在b.properties 文件中写 broker-b</span></span><br><span class=\"line\"><span class=\"attr\">brokerName</span>=<span class=\"string\">broker-b</span></span><br><span class=\"line\"><span class=\"comment\">#0 表示 Master，&gt;0 表示 Slave</span></span><br><span class=\"line\"><span class=\"attr\">brokerId</span>=<span class=\"string\">0</span></span><br><span class=\"line\"><span class=\"comment\">#删除文件时间点，默认凌晨 4点</span></span><br><span class=\"line\"><span class=\"attr\">deleteWhen</span>=<span class=\"string\">04</span></span><br><span class=\"line\"><span class=\"comment\">#文件保留时间，默认 48 小时</span></span><br><span class=\"line\"><span class=\"attr\">fileReservedTime</span>=<span class=\"string\">168</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 的角色，ASYNC_MASTER=异步复制Master，SYNC_MASTER=同步双写Master，SLAVE=slave节点</span></span><br><span class=\"line\"><span class=\"attr\">brokerRole</span>=<span class=\"string\">ASYNC_MASTER</span></span><br><span class=\"line\"><span class=\"comment\">#刷盘方式，ASYNC_FLUSH=异步刷盘，SYNC_FLUSH=同步刷盘 </span></span><br><span class=\"line\"><span class=\"attr\">flushDiskType</span>=<span class=\"string\">SYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 对外服务的监听端口</span></span><br><span class=\"line\"><span class=\"attr\">listenPort</span>=<span class=\"string\">11911</span></span><br><span class=\"line\"><span class=\"comment\">#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）</span></span><br><span class=\"line\"><span class=\"attr\">namesrvAddr</span>=<span class=\"string\">192.168.2.246:9876</span></span><br><span class=\"line\"><span class=\"comment\">#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡</span></span><br><span class=\"line\"><span class=\"attr\">defaultTopicQueueNums</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建Topic，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateTopicEnable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建订阅组，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateSubscriptionGroup</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置BrokerIP</span></span><br><span class=\"line\"><span class=\"attr\">brokerIP1</span>=<span class=\"string\">192.168.2.246</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>broker-b-s.conf</strong></p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#所属集群名字</span></span><br><span class=\"line\"><span class=\"attr\">brokerClusterName</span>=<span class=\"string\">rocketmq-cluster</span></span><br><span class=\"line\"><span class=\"attr\">brokerName</span>=<span class=\"string\">broker-b</span></span><br><span class=\"line\"><span class=\"comment\">#slave</span></span><br><span class=\"line\"><span class=\"attr\">brokerId</span>=<span class=\"string\">1</span></span><br><span class=\"line\"><span class=\"attr\">deleteWhen</span>=<span class=\"string\">04</span></span><br><span class=\"line\"><span class=\"attr\">fileReservedTime</span>=<span class=\"string\">168</span></span><br><span class=\"line\"><span class=\"attr\">brokerRole</span>=<span class=\"string\">SLAVE</span></span><br><span class=\"line\"><span class=\"attr\">flushDiskType</span>=<span class=\"string\">ASYNC_FLUSH</span></span><br><span class=\"line\"><span class=\"comment\">#Broker 对外服务的监听端口</span></span><br><span class=\"line\"><span class=\"attr\">listenPort</span>=<span class=\"string\">13911</span></span><br><span class=\"line\"><span class=\"comment\">#nameServer地址，这里nameserver是单台，如果nameserver是多台集群的话，就用分号分割（即namesrvAddr=ip1:port1;ip2:port2;ip3:port3）</span></span><br><span class=\"line\"><span class=\"attr\">namesrvAddr</span>=<span class=\"string\">192.168.2.246:9876</span></span><br><span class=\"line\"><span class=\"comment\">#每个topic对应队列的数量，默认为4，实际应参考consumer实例的数量，值过小不利于consumer负载均衡</span></span><br><span class=\"line\"><span class=\"attr\">defaultTopicQueueNums</span>=<span class=\"string\">8</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建Topic，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateTopicEnable</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#是否允许 Broker 自动创建订阅组，生产建议关闭</span></span><br><span class=\"line\"><span class=\"attr\">autoCreateSubscriptionGroup</span>=<span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"comment\">#设置BrokerIP</span></span><br><span class=\"line\"><span class=\"attr\">brokerIP1</span>=<span class=\"string\">192.168.2.246</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"构建docker-compose-yml配置文件\"><a href=\"#构建docker-compose-yml配置文件\" class=\"headerlink\" title=\"构建docker-compose.yml配置文件\"></a>构建docker-compose.yml配置文件</h4><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&#x27;2&#x27;</span></span><br><span class=\"line\"><span class=\"attr\">services:</span></span><br><span class=\"line\">  <span class=\"attr\">namesrv1:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">namesrv1</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">9876</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-namesrv-m:/home/rocketmq/logs</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256M</span> <span class=\"string\">-Xmx256M</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqnamesrv</span></span><br><span class=\"line\">  <span class=\"attr\">broker-a-m:</span></span><br><span class=\"line\">      <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">      <span class=\"attr\">container_name:</span> <span class=\"string\">broker-a-master</span></span><br><span class=\"line\">      <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">10909</span><span class=\"string\">:10909</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">10911</span><span class=\"string\">:10911</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">10912</span><span class=\"string\">:10912</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-broker-a:/home/rocketmq/logs</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/store-a:/home/rocketmq/store</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/conf/broker-a.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">      <span class=\"attr\">environment:</span></span><br><span class=\"line\">        <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256m</span> <span class=\"string\">-Xmx256m</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">        <span class=\"attr\">NAMESRV_ADDR:</span> <span class=\"number\">192.168</span><span class=\"number\">.2</span><span class=\"number\">.246</span><span class=\"string\">:9876</span></span><br><span class=\"line\">      <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqbroker</span>  <span class=\"string\">-c</span> <span class=\"string\">/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">  <span class=\"attr\">broker-b-m:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">broker-b-master</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">11909</span><span class=\"string\">:11909</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">11911</span><span class=\"string\">:11911</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">11912</span><span class=\"string\">:11912</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-broker-b:/home/rocketmq/logs</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/store-b:/home/rocketmq/store</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/conf/broker-b.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256m</span> <span class=\"string\">-Xmx256m</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">      <span class=\"attr\">NAMESRV_ADDR:</span> <span class=\"number\">192.168</span><span class=\"number\">.2</span><span class=\"number\">.246</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqbroker</span>  <span class=\"string\">-c</span> <span class=\"string\">/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">  <span class=\"attr\">broker-a-s:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">broker-a-slave</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">12909</span><span class=\"string\">:12909</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">12911</span><span class=\"string\">:12911</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">12912</span><span class=\"string\">:12912</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-broker-a-s:/home/rocketmq/logs</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/store-a-s:/home/rocketmq/store</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/conf/broker-a-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256m</span> <span class=\"string\">-Xmx256m</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">      <span class=\"attr\">NAMESRV_ADDR:</span> <span class=\"number\">192.168</span><span class=\"number\">.2</span><span class=\"number\">.246</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqbroker</span>  <span class=\"string\">-c</span> <span class=\"string\">/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">  <span class=\"attr\">broker-b-s:</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">foxiswho/rocketmq:4.8.0</span></span><br><span class=\"line\">    <span class=\"attr\">container_name:</span> <span class=\"string\">broker-b-slave</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">13909</span><span class=\"string\">:13909</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">13911</span><span class=\"string\">:13911</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"number\">13912</span><span class=\"string\">:13912</span></span><br><span class=\"line\">    <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/logs-broker-b-s:/home/rocketmq/logs</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/store-b-s:/home/rocketmq/store</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">/data/docker/rocketmq/conf/broker-b-s.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">      <span class=\"attr\">JAVA_OPT_EXT:</span> <span class=\"string\">-server</span> <span class=\"string\">-Xms256m</span> <span class=\"string\">-Xmx256m</span> <span class=\"string\">-Xmn128m</span></span><br><span class=\"line\">      <span class=\"attr\">NAMESRV_ADDR:</span> <span class=\"number\">192.168</span><span class=\"number\">.2</span><span class=\"number\">.246</span><span class=\"string\">:9876</span></span><br><span class=\"line\">    <span class=\"attr\">command:</span> <span class=\"string\">sh</span> <span class=\"string\">mqbroker</span>  <span class=\"string\">-c</span> <span class=\"string\">/home/rocketmq/rocketmq-4.8.0/conf/broker.conf</span></span><br><span class=\"line\">    <span class=\"attr\">depends_on:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">namesrv1</span></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"主从节点配置信息\"><a href=\"#主从节点配置信息\" class=\"headerlink\" title=\"主从节点配置信息\"></a>主从节点配置信息</h4><table>\n<thead>\n<tr>\n<th>System Info</th>\n<th>IP:PORT</th>\n<th>BrokerId</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>namesrv1</code></td>\n<td>192.168.2.246:<code>9876</code></td>\n<td></td>\n</tr>\n<tr>\n<td><code>broker-a</code></td>\n<td>192.168.2.246:<code>10911</code></td>\n<td>0</td>\n</tr>\n<tr>\n<td><code>broker-a-s</code></td>\n<td>192.168.2.246:<code>12911</code></td>\n<td>1</td>\n</tr>\n<tr>\n<td><code>broker-b</code></td>\n<td>192.168.2.246:<code>11911</code></td>\n<td>0</td>\n</tr>\n<tr>\n<td><code>broker-b-s</code></td>\n<td>192.168.2.246:<code>13911</code></td>\n<td>1</td>\n</tr>\n</tbody></table>\n<h4 id=\"Docker容器分布\"><a href=\"#Docker容器分布\" class=\"headerlink\" title=\"Docker容器分布\"></a>Docker容器分布</h4><p><img src=\"https://img.lattice.vip/typora/2022/image-20220820204340646.png\" alt=\"image-20220820204340646\"></p>\n<h3 id=\"部署RocketMQ-Console\"><a href=\"#部署RocketMQ-Console\" class=\"headerlink\" title=\"部署RocketMQ-Console\"></a>部署RocketMQ-Console</h3><p>获取RocketMQ-Console镜像，连接NameServer中心，新版本以及迁移到新的Repo,名称为RockeMQ-Dashboard</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 拉取控制台镜像</span></span><br><span class=\"line\">lattice@lattice-cluster-01:/<span class=\"variable\">$docker</span> pull styletang/rocketmq-console-ng</span><br><span class=\"line\"><span class=\"comment\"># 启动容器</span></span><br><span class=\"line\">lattice@lattice-cluster-01:/<span class=\"variable\">$docker</span> run -d -e <span class=\"string\">&quot;JAVA_OPTS=-Drocketmq.config.namesrvAddr=192.168.2.246:9876 -Drocketmq.config.isVIPChannel=false&quot;</span> -p 8088:8080 -t styletang/rocketmq-console-ng    </span><br></pre></td></tr></table></figure>\n\n<p>部署成功界面</p>\n<p><img src=\"https://img.lattice.vip/typora/2022/image-20220819082950746.png\" alt=\"image-20220819082950746\"></p>\n<h3 id=\"遇到的问题\"><a href=\"#遇到的问题\" class=\"headerlink\" title=\"遇到的问题\"></a>遇到的问题</h3><ul>\n<li><p>broker exited 253</p>\n<ul>\n<li>最终定位下来问题原因，映射到宿主机的目录卷权限不够，无法应用broker等的配置文件，以及无法操作日志目录</li>\n</ul>\n</li>\n<li><p>宿主机普通用户每次操作docker命令都需要指定sudo，甚是麻烦</p>\n<ul>\n<li><p>解决方案：加入docker组</p>\n</li>\n<li><p>```bash<br>sudo usermod -aG docker xxx</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">- 一直报file path的问题，需要手动创建对应目录</span><br><span class=\"line\"></span><br><span class=\"line\">    - ```</span><br><span class=\"line\">    mkdir /data/docker/rocketmq/store-a/commitlog/</span><br><span class=\"line\">    mkdir /data/docker/rocketmq/store-a/consumequeue/</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p>搭建集群的过程中确实有遇到一些莫名其妙的问题，例如 Namesrv 最开始部署了两台，9876/9877 ，最终却连不上 9877 ，后来便放弃，使用单节点 Namesrv</p>\n</li>\n</ul>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cl78v0x5q00016c7e46tg3dq5","category_id":"cl7a6yja90000zw7eg86sawgf","_id":"cl7a6yjad0001zw7efrtc1w3v"}],"PostTag":[{"post_id":"cl78v0x5q00016c7e46tg3dq5","tag_id":"cl7a6wiwf0000ao7e1edc0nx5","_id":"cl7a6wiwi0002ao7e2a6p3ye0"},{"post_id":"cl78v0x5q00016c7e46tg3dq5","tag_id":"cl7a6wiwh0001ao7e5npcbnzu","_id":"cl7a6wiwi0003ao7e94zqbjcp"}],"Tag":[{"name":"开发环境","_id":"cl78v0x6500026c7eh9ao3jrd"},{"name":"Linux","_id":"cl7a6wiwf0000ao7e1edc0nx5"},{"name":"RocketMQ","_id":"cl7a6wiwh0001ao7e5npcbnzu"}]}}